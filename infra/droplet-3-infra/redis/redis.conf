# Redis Configuration for BaseCommerce
# Optimized for event streaming with Redis Streams
# Target: 2GB RAM droplet, shared with PostgreSQL

#------------------------------------------------------------------------------
# NETWORK
#------------------------------------------------------------------------------
bind 0.0.0.0
port 6379
tcp-keepalive 300
timeout 0
tcp-backlog 511

#------------------------------------------------------------------------------
# GENERAL
#------------------------------------------------------------------------------
daemonize no
databases 16
always-show-logo no

#------------------------------------------------------------------------------
# MEMORY MANAGEMENT
#------------------------------------------------------------------------------
# Max 256MB for Redis (rest goes to PostgreSQL)
maxmemory 256mb
maxmemory-policy noeviction

# Lazy free (async deletion)
lazyfree-lazy-eviction yes
lazyfree-lazy-expire yes
lazyfree-lazy-server-del yes

#------------------------------------------------------------------------------
# PERSISTENCE
#------------------------------------------------------------------------------
# RDB snapshots (for crash recovery)
save 900 1
save 300 10
save 60 10000

# RDB file
dbfilename dump.rdb
dir /data

# Stop accepting writes on RDB error
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes

# AOF disabled (Redis Streams data can be regenerated from outbox)
appendonly no

#------------------------------------------------------------------------------
# STREAMS
#------------------------------------------------------------------------------
# Default stream consumer group settings
# Stream entries are kept until explicitly deleted
# XAUTOCLAIM settings
stream-node-max-bytes 4096
stream-node-max-entries 100

#------------------------------------------------------------------------------
# SLOW LOG
#------------------------------------------------------------------------------
slowlog-log-slower-than 10000
slowlog-max-len 128

#------------------------------------------------------------------------------
# CLIENTS
#------------------------------------------------------------------------------
maxclients 100

#------------------------------------------------------------------------------
# SECURITY
#------------------------------------------------------------------------------
# Protected mode disabled (we use network isolation via Docker)
protected-mode no
# Disable dangerous commands
rename-command FLUSHDB ""
rename-command FLUSHALL ""
rename-command DEBUG ""
rename-command CONFIG ""

